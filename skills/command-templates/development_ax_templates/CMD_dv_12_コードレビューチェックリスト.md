# CMD_dv_12_コードレビューチェックリスト

最終更新日時: 2026年1月29日

# コードレビューチェックリスト自動生成テンプレート

> **プロジェクト固有のコードレビューチェックリストを生成し、レビュー品質を標準化**

---

## 🎯 このテンプレートでできること

- 言語・フレームワーク固有のチェック項目生成
- セキュリティチェックリスト作成
- パフォーマンスチェックリスト作成
- 可読性・保守性チェックリスト作成
- PR（Pull Request）テンプレート生成
- 自動チェック可能項目の特定
- CI/CD連携設定

---

## 📋 実行前の質問（必須回答）

### 1. コードベース情報
- 主要言語: （TypeScript, Python, Java等）
- フレームワーク: （Next.js, Django, Spring Boot等）
- コーディング規約の有無: （Yes/No）
- 既存のチェックリストの有無: （Yes/No）

### 2. レビュー体制
- レビュアー数: 
- レビュー観点: （機能正確性、セキュリティ、パフォーマンス等）
- 重点領域: （特に注意すべき領域）

### 3. CI/CD環境
- CI/CDツール: （GitHub Actions, GitLab CI等）
- 既存の自動チェックツール: （ESLint, SonarQube等）

---

## 🔄 実行手順

### Phase 1: チェック項目生成（20分）【自動】

```yaml
実行内容:
  - 言語固有のベストプラクティス抽出
  - フレームワーク固有の推奨事項
  - セキュリティチェック項目
  - パフォーマンスチェック項目
  - 可読性・保守性チェック項目

使用Role: role_qa_engineer, role_code_analyst

成果物:
  - checklist_draft.md
  - security_checklist.md
  - performance_checklist.md
```

**AIの動作:**
```
📝 コードレビューチェックリストを生成しています...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# コードレビューチェックリスト（TypeScript/Next.js）

## 1. 機能正確性

### 1.1 要件実装
- [ ] 要件通りに実装されているか
- [ ] 仕様書・DesignDocと整合しているか
- [ ] エッジケースが考慮されているか
- [ ] エラーハンドリングが適切か

### 1.2 ロジック
- [ ] ビジネスロジックが正しいか
- [ ] 条件分岐が適切か
- [ ] ループ処理が正しく終了するか
- [ ] 計算ロジックにバグがないか

### 1.3 データ処理
- [ ] データの入力・出力が正しいか
- [ ] データ変換が適切か
- [ ] null/undefinedのハンドリングが適切か
- [ ] 型安全性が保たれているか

---

## 2. コード品質

### 2.1 命名規則
- [ ] 変数名が意味を表しているか
- [ ] 関数名が動詞で始まっているか
- [ ] クラス名がPascalCaseか
- [ ] 定数が大文字スネークケースか
- [ ] booleanの命名が適切か（is/has/canなど）

### 2.2 関数・メソッド
- [ ] 関数が単一責任の原則に従っているか
- [ ] 関数が適切な長さか（50行以内が目安）
- [ ] 引数が多すぎないか（3-4個以内が目安）
- [ ] 副作用が明確か
- [ ] 返り値の型が明示されているか

### 2.3 クラス・モジュール
- [ ] クラスが単一責任の原則に従っているか
- [ ] 適切なデザインパターンが使われているか
- [ ] 依存関係が適切に注入されているか
- [ ] カプセル化が適切か

### 2.4 DRY原則
- [ ] コードの重複がないか
- [ ] 共通処理が適切に抽出されているか
- [ ] ユーティリティ関数が活用されているか

### 2.5 コメント・ドキュメント
- [ ] 複雑なロジックにコメントがあるか
- [ ] TODOコメントに期限・担当者が記載されているか
- [ ] 不要なコメントアウトが削除されているか
- [ ] JSDocが適切に記載されているか
- [ ] READMEが更新されているか

---

## 3. セキュリティ

### 3.1 入力値検証
- [ ] ユーザー入力が検証されているか
- [ ] バリデーションが適切か（型、長さ、形式）
- [ ] サニタイゼーションが行われているか

### 3.2 認証・認可
- [ ] 認証チェックが適切か
- [ ] 権限チェックが適切か
- [ ] セッション管理が適切か
- [ ] JWTの検証が適切か

### 3.3 データ保護
- [ ] 機密情報がハードコードされていないか
- [ ] 環境変数が適切に使用されているか
- [ ] パスワードがハッシュ化されているか
- [ ] APIキーが保護されているか

### 3.4 脆弱性対策
- [ ] SQLインジェクション対策がされているか
- [ ] XSS対策がされているか（エスケープ処理）
- [ ] CSRF対策がされているか
- [ ] パストラバーサル対策がされているか

### 3.5 外部連携
- [ ] 外部APIの呼び出しが適切か
- [ ] タイムアウト設定がされているか
- [ ] エラーレスポンスが適切に処理されているか
- [ ] レート制限が考慮されているか

---

## 4. パフォーマンス

### 4.1 データベース
- [ ] N+1クエリがないか
- [ ] 適切なインデックスが使用されているか
- [ ] 不要なクエリがないか
- [ ] トランザクションが適切に使用されているか

### 4.2 アルゴリズム
- [ ] 計算量が最適化されているか
- [ ] 不要なループがないか
- [ ] 早期リターンが活用されているか

### 4.3 フロントエンド
- [ ] 不要な再レンダリングがないか
- [ ] useMemo/useCallbackが適切に使用されているか
- [ ] 画像が最適化されているか
- [ ] 遅延ロードが考慮されているか

### 4.4 メモリ
- [ ] メモリリークの可能性がないか
- [ ] 大きなデータ構造が適切に管理されているか
- [ ] イベントリスナーがクリーンアップされているか

---

## 5. テスト

### 5.1 テストカバレッジ
- [ ] 新規コードにユニットテストが追加されているか
- [ ] カバレッジが維持/向上しているか（目標80%以上）
- [ ] 重要なロジックがテストされているか

### 5.2 テスト品質
- [ ] テストケースが意味のあるアサーションを持つか
- [ ] テストが独立しているか
- [ ] テストデータが適切か
- [ ] モック/スタブが適切に使用されているか

### 5.3 統合テスト
- [ ] API統合テストが追加されているか（必要に応じて）
- [ ] E2Eテストが追加されているか（重要フロー）

---

## 6. TypeScript/Next.js固有

### 6.1 TypeScript
- [ ] any型の使用が最小限か
- [ ] 型定義が適切か
- [ ] 型アサーションが必要最小限か
- [ ] Genericsが適切に使用されているか
- [ ] Enumの代わりにUnion型が使われているか（推奨）

### 6.2 Next.js App Router
- [ ] Server ComponentとClient Componentの使い分けが適切か
- [ ] 'use client'ディレクティブが適切に使用されているか
- [ ] データフェッチがServer Componentで行われているか
- [ ] loadingとerrorページが実装されているか

### 6.3 React Hooks
- [ ] Hooksのルールに従っているか
- [ ] useEffectの依存配列が正しいか
- [ ] カスタムHooksが適切に抽出されているか

### 6.4 状態管理
- [ ] 状態のスコープが適切か
- [ ] グローバル状態管理が必要な場所で使われているか
- [ ] 不要なpropsのバケツリレーがないか

---

## 7. エラーハンドリング

### 7.1 例外処理
- [ ] try-catchが適切に使用されているか
- [ ] エラーが適切にログ出力されているか
- [ ] エラーメッセージが分かりやすいか
- [ ] ユーザーへのエラー表示が適切か

### 7.2 エラーリカバリ
- [ ] エラー時のリトライロジックがあるか（必要に応じて）
- [ ] フォールバック処理があるか
- [ ] ユーザーへのフィードバックがあるか

---

## 8. その他

### 8.1 依存関係
- [ ] 不要なパッケージがインポートされていないか
- [ ] パッケージのバージョンが適切か
- [ ] 脆弱性のあるパッケージが使われていないか

### 8.2 設定ファイル
- [ ] .envファイルが適切か
- [ ] .gitignoreが更新されているか
- [ ] package.jsonが更新されているか

### 8.3 CI/CD
- [ ] CIが通過しているか
- [ ] Linterエラーがないか
- [ ] ビルドが成功しているか

### 8.4 ドキュメント
- [ ] APIドキュメントが更新されているか
- [ ] 変更履歴が記録されているか
- [ ] マイグレーション手順が明記されているか（DB変更時）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📄 checklist_draft.md を生成しました
```

---

### HITL-1: チェック項目カスタマイズ（10分）【人間】

**プロンプト:**
```
📋 チェックリストを確認してください

【確認事項】
✓ チーム固有の追加項目はありますか？
✓ 不要な項目はありますか？
✓ 優先度の調整が必要な項目はありますか？

【カスタマイズ例】
- 「GraphQL使用時はN+1対策を必須チェック」を追加
- 「アクセシビリティチェック」セクションを追加
- 「パフォーマンス」セクションの優先度を上げる

次のステップに進むには「承認」と入力してください。
修正が必要な場合は、具体的に指示してください。
```

---

### Phase 2: PR Template & CI連携（15分）【自動】

```yaml
実行内容:
  - PRテンプレート生成
  - 自動チェック可能項目の特定
  - Linter/Formatter設定
  - CI/CDワークフロー生成

使用Role: role_qa_engineer, role_code_analyst

成果物:
  - .github/pull_request_template.md
  - automated_checks.yaml
  - .eslintrc.json（更新）
  - .github/workflows/code-quality.yml
```

**AIの動作:**
```
🤖 PRテンプレートとCI連携を設定しています...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Pull Request テンプレート

## 📝 変更内容
<!-- 何を変更したか簡潔に記載 -->

## 🎯 関連Issue
Closes #XXX

## 🧪 テスト
- [ ] ユニットテストを追加/更新した
- [ ] 統合テストを追加/更新した
- [ ] 手動テストを実施した

## 📋 チェックリスト

### コード品質
- [ ] コードレビューチェックリストを確認した
- [ ] Linterエラーがない
- [ ] 型エラーがない
- [ ] テストが全て通過している

### セキュリティ
- [ ] 機密情報がハードコードされていない
- [ ] 入力値検証が適切に行われている
- [ ] 認証・認可チェックが適切である

### パフォーマンス
- [ ] N+1クエリがない
- [ ] 不要な再レンダリングがない

### ドキュメント
- [ ] README/ドキュメントを更新した（必要に応じて）
- [ ] APIドキュメントを更新した（API変更時）

## 📸 スクリーンショット（UI変更時）
<!-- スクリーンショットを添付 -->

## 🔗 参考資料
<!-- 関連するドキュメントやリンク -->

---

## 🤖 自動チェック項目

以下は自動的にチェックされます：

### Linter
- ESLint: コードスタイル、ベストプラクティス
- Prettier: フォーマット
- TypeScript: 型チェック

### Security
- npm audit: 脆弱性スキャン
- CodeQL: セキュリティ脆弱性検出

### Testing
- Unit Tests: カバレッジ80%以上
- Integration Tests: 主要API
- E2E Tests: 重要フロー

### Performance
- Lighthouse CI: パフォーマンススコア

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📄 .github/pull_request_template.md を生成しました
📄 .github/workflows/code-quality.yml を生成しました

# GitHub Actions ワークフロー

```yaml
name: Code Quality

on:
  pull_request:
  push:
    branches: [main, develop]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm ci
      - run: npm run lint
      - run: npm run type-check

  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm audit
      - uses: github/codeql-action/init@v2
      - uses: github/codeql-action/analyze@v2

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm ci
      - run: npm run test:coverage
      - uses: codecov/codecov-action@v3
        with:
          fail_ci_if_error: true
          threshold: 80

  performance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: treosh/lighthouse-ci-action@v10
        with:
          urls: |
            http://localhost:3000
          budgetPath: ./lighthouserc.json
```

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✨ コードレビューチェックリスト作成が完了しました！

【生成ファイル】
1. code_review_checklist.md         ← チェックリスト本体
2. .github/pull_request_template.md ← PRテンプレート
3. .github/workflows/code-quality.yml ← CI設定
4. automated_checks_summary.md      ← 自動チェック項目一覧

【チェック項目数】
- 機能正確性: 12項目
- コード品質: 18項目
- セキュリティ: 14項目
- パフォーマンス: 10項目
- テスト: 8項目
- 言語固有: 15項目

【自動化率】
- 自動チェック可能: 45%
- 手動チェック必要: 55%

【次のステップ】
- チームへの共有・トレーニング
- CI/CDパイプラインへの組み込み
- 定期的なチェックリストの見直し
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## ✅ 完了条件チェックリスト

- [ ] チェックリストが網羅的である
- [ ] チーム固有の項目が追加されている
- [ ] PRテンプレートが生成されている
- [ ] 自動チェック項目が特定されている
- [ ] CI/CD設定が完了している
- [ ] ドキュメントが整備されている
- [ ] チームへの共有が完了している

---

## 📋 言語別チェックリスト例

### Python
- [ ] PEP 8に準拠しているか
- [ ] Type Hintsが適切に使用されているか
- [ ] Docstringが記載されているか
- [ ] virtualenv/poetryで依存管理されているか

### Java
- [ ] Javaコーディング規約に準拠しているか
- [ ] NullPointerException対策がされているか
- [ ] リソースのクローズ処理が適切か
- [ ] ログ出力が適切か（SLF4J推奨）

### Go
- [ ] gofmtでフォーマットされているか
- [ ] エラーハンドリングが適切か
- [ ] Goroutineのリーク対策がされているか
- [ ] contextが適切に使用されているか

---

## 🎯 レビュー観点の重み付け例

| 観点 | 重要度 | 必須チェック |
|------|--------|-------------|
| セキュリティ | 最高 | ✅ 必須 |
| 機能正確性 | 高 | ✅ 必須 |
| テスト | 高 | ✅ 必須 |
| パフォーマンス | 中 | △ 必要に応じて |
| コード品質 | 中 | △ 必要に応じて |
| コメント | 低 | △ 推奨 |

---

## 🔗 関連テンプレート

- [CMD_dv_10_DesignDoc作成](./CMD_dv_10_DesignDoc作成.md)
- [CMD_dv_11_テスト計画作成](./CMD_dv_11_テスト計画作成.md)
- [CMD_sys_06_テスト設計](../system_building_templates/CMD_sys_06_テスト設計.md)

---

## 📊 所要時間の目安

| フェーズ | 自動 | HITL | 合計 |
|---------|------|------|------|
| Phase 1 | 20分 | - | 20分 |
| HITL-1 | - | 10分 | 10分 |
| Phase 2 | 15分 | - | 15分 |
| **合計** | **35分** | **10分** | **45分** |

---

## 💡 活用のヒント

### 1. レビュー前の自己チェック
開発者がPR作成前にチェックリストで自己レビューを行う

### 2. ペアレビュー
2人のレビュアーが異なる観点でチェックする
- レビュアーA: 機能正確性・ロジック
- レビュアーB: セキュリティ・パフォーマンス

### 3. 定期的な更新
四半期ごとにチェックリストを見直し、改善点を反映する

### 4. 自動化の推進
自動チェック可能な項目は積極的にCI/CDに組み込む

---

**作成日**: 2026-01-29
**カテゴリ**: 開発AX（Developer Experience）
**タスクタイプ**: documentation
**関連Role**: role_qa_engineer, role_code_analyst
