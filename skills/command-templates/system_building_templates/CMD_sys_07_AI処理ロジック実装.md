# CMD_sys_07_AI処理ロジック実装

最終更新日時: 2025年12月25日 9:06

# 07_AI処理ロジック実装 - Notion AI機能を使った処理ロジック構築テンプレート

<aside>
🤖

**このテンプレートの目的**

NotionのAI機能（AI Block・Slash Command）を使って、テキスト処理・分析・生成などの処理ロジックを実装します。

AIをプログラムのロジックとして埋め込み、実行可能なシステムを構築します。

</aside>

---

## 📋 適用対象タスク

**タスクタイプ**: `implementation`

**該当するタスク名の例**:

- "○○分析ロジック実装"
- "○○生成アルゴリズム実装"
- "AI処理機能の実装"
- "自動○○機能の実装"

---

## 🎯 完了条件

<aside>
✅

**必須成果物**

1. **AI Block/Operation Command** - 実際に動作するAI処理
2. **プロンプト定義** - 明確な入力・処理・出力の定義
3. **実行テスト完了** - 実際にAIを実行して動作確認済み
4. **処理ロジック設計書** - 処理フロー・使用方法のドキュメント
</aside>

---

## 📝 実行フロー（5 Phase）

### Phase 1: 処理要件確認・ロジック設計（15分）

**目的**: 何を処理するAIか、入力・出力は何かを明確化

**実行内容**:

```yaml
確認事項:
  - 処理対象: 何を処理するAIか？（テキスト分析/構成案生成/要約/翻訳等）
  - 入力: どんなデータを受け取るか？（URL/テキスト/Database値）
  - 処理内容: AIに何をさせるか？（分析/生成/判定/変換）
  - 出力: どんな形式で出力するか？（テキスト/構造化データ/Databaseページ）
  - 実行トリガー: いつ実行されるか？（Form送信後/Button押下/手動実行）

ロジック設計:
  処理フロー図:
    1. 入力データ取得
    2. AI処理実行
    3. 出力データ整形
    4. 結果保存・通知
  
  プロンプト設計:
    - システムロール定義
    - 入力変数の指定方法
    - 出力フォーマット指定
    - Few-shot例示（必要に応じて）
```

**チェックポイント**:

- [ ]  処理対象・入力・出力が明確に定義されている
- [ ]  処理フロー図が完成している
- [ ]  プロンプト設計ができている

---

### Phase 2: プロンプト作成・AI Block実装（20分）

**目的**: AI Blockまたはコマンドページにプロンプトを実装

**実行内容**:

```yaml
AI Block実装:
  
  実装方法A: ページ内AI Block
    使用シーン: 単発処理、ページ内で完結する処理
    実装手順:
      1. 処理対象ページにAI Blockを追加
      2. プロンプトを記述
      3. 入力変数を{variable}形式で指定
      4. 実行・動作確認
  
  実装方法B: Operation Command
    使用シーン: 繰り返し実行、複数ステップの処理
    実装手順:
      1. operation_xxxコマンドページを作成
      2. variables.yaml定義
      3. 実行フロー定義
      4. 各ステップのプロンプト記述

プロンプトテンプレート例:
  
  記事分析AI:
```

あなたは記事構造の分析専門家です。

以下の記事URLを分析してください：

記事URL: {input.記事URL}

分析項目：

1. 章立て構造（見出しレベルと内容）
2. 記事の流れ（導入→本文→結論の構成）
3. 主要な要素（図表/引用/コード等）
4. 記事スタイル（フォーマル/カジュアル/技術的等）
5. 文字数・読了時間の推定

出力フォーマット：

```yaml
章立て:
  - レベル1: タイトル
    - レベル2: サブタイトル

流れ:
  導入: [概要]
  本文: [展開]
  結論: [まとめ]

要素:
  - 図表: N個
  - 引用: N個
  - コード: N個

スタイル: [フォーマル/カジュアル/技術的]
文字数: N文字
読了時間: N分
```

```

構成案生成AI:
```

あなたは記事構成の設計専門家です。

以下の情報をもとに、記事構成案を3-5パターン生成してください：

- テーマ: {input.テーマ}
- 対象読者: {input.対象読者}
- 文字数目標: {input.文字数}
- 参考記事分析結果: {input.分析結果}

各パターンには以下を含めてください：

1. タイトル案
2. 章立て（3-7章）
3. 各章の内容概要
4. 推定文字数配分
5. このパターンの特徴・強み

出力フォーマット：

```markdown
## パターン1: [タイトル]

### 章立て
1. [章名]（推定XXX文字）
   - 内容: [概要]
2. [章名]（推定XXX文字）
   - 内容: [概要]
...

### 特徴
[このパターンの強み・適用シーン]
```

```

```

**チェックポイント**:

- [ ]  AI Blockまたはコマンドページが作成されている
- [ ]  プロンプトが実装されている
- [ ]  入力変数が正しく指定されている

---

### Phase 3: 入力・出力インターフェース実装（15分）

**目的**: AIが受け取るデータの取得方法と、出力先を実装

**実行内容**:

```yaml
入力インターフェース:
  
  パターンA: Databaseから取得
    実装:
      1. 入力データを管理するDatabase準備
      2. AI処理対象のレコードをフィルタ（Status = 未処理）
      3. AI実行時に該当レコードの値を参照
    
    例:
      Database: 記事入力DB
      Filter: Status = "未処理"
      取得項目: 記事URL, テーマ, 対象人物
  
  パターンB: Formから取得
    実装:
      1. Form作成（06_Form実装テンプレート使用）
      2. Form送信→Database保存
      3. AI処理がDatabaseを監視・実行
  
  パターンC: 手動入力
    実装:
      1. コマンドページに入力欄を用意
      2. ユーザーが値を入力
      3. AI実行時に入力値を参照

出力インターフェース:
  
  パターンA: Databaseに保存
    実装:
      1. 出力データを管理するDatabase準備
      2. AI実行後、結果を構造化
      3. create-pagesで新規ページ作成・保存
    
    例:
      Database: 構成案DB
      保存項目: タイトル, 章立て, 推定文字数, 特徴
  
  パターンB: ページ生成
    実装:
      1. AI実行後、結果をNotion-flavored markdownに整形
      2. create-pagesで新規ページ作成
      3. 親ページ・Databaseに紐づけ
  
  パターンC: 既存ページ更新
    実装:
      1. AI実行後、結果をテキストに整形
      2. update-pageで既存ページに追記
```

**チェックポイント**:

- [ ]  入力データの取得方法が実装されている
- [ ]  出力データの保存方法が実装されている
- [ ]  入力→処理→出力の流れが機能している

---

### Phase 4: 実行テスト・品質確認（15分）

**目的**: 実際にAIを実行して、期待通りの出力が得られるか確認

**実行内容**:

```yaml
テストケース実行:
  
  1. 標準ケース:
     - 典型的な入力データ
     - 期待される出力が得られるか
  
  2. エッジケース:
     - 極端に短い/長い入力
     - 特殊文字・記号を含む入力
     - 空データ・欠損データ
  
  3. 複数パターンテスト:
     - 異なる種類の入力データ
     - 出力の一貫性・品質確認

品質確認項目:
  - [ ] 出力フォーマットが指定通りか
  - [ ] 出力内容が論理的に正しいか
  - [ ] 文字数・項目数が要件を満たしているか
  - [ ] エッジケースで異常終了しないか
  - [ ] 実行時間が許容範囲内か

プロンプト改善:
  問題があれば:
    - プロンプトの明確化
    - Few-shot例示の追加
    - 出力フォーマットの明示
    - システムロールの調整
```

**チェックポイント**:

- [ ]  最低3パターンのテストが成功している
- [ ]  出力品質が要件を満たしている
- [ ]  エッジケースでも正しく動作する

---

### Phase 5: ドキュメント整備・運用ガイド作成（10分）

**目的**: 処理ロジック設計書と使用方法を作成

**実行内容**:

```yaml
処理ロジック設計書:
  内容:
    - 処理概要（何をするAIか）
    - 入力仕様（何を受け取るか/型/必須項目）
    - 処理フロー図
    - プロンプト全文
    - 出力仕様（何を出力するか/フォーマット）
    - 実行条件・トリガー

使用方法ガイド:
  内容:
    - AI実行方法（どのコマンド/ボタンを使うか）
    - 入力データの準備方法
    - 実行後の確認方法（どこに出力されるか）
    - トラブルシューティング（よくあるエラーと対処法）
    - 実行例（スクリーンショット付き）

Operation Command化（Abstract Mode時）:
  variables.yaml作成:
```

target_person: "対象人物名"

theme: "記事テーマ"

reference_url: "参考記事URL"

word_count: 10000

```

Operation Command作成:
  - 変数を受け取る実行フロー
  - 再利用可能なコマンドページ
  - 実行履歴の記録
```

**チェックポイント**:

- [ ]  処理ロジック設計書が完成している
- [ ]  使用方法ガイドが完成している
- [ ]  Operation Command化されている（Abstract Mode時）

---

## 🔗 関連テンプレート

- **05_Database実装** - AI処理の入力元・出力先のDatabaseを作成
- **06_Form・入力UI実装** - AIへの入力フォームを作成
- **04_Wiki構築** - AI処理の使い方をWikiで公開

---

## 📚 参考リソース

### Notion公式ドキュメント

- Notion AI: [https://www.notion.com/ja/product/ai](https://www.notion.com/ja/product/ai)
- AI Blocks: [https://www.notion.com/ja/help/guides/using-notion-ai](https://www.notion.com/ja/help/guides/using-notion-ai)

### 内部リソース

- [CTX_abstract_mode_rules](../../abstract-mode.md) - Notion実装ガイド
- [CTX_execution_rules](../../execution-rules.md) - 実行ルール
- [operation_command_template](../operation_command_template.md) - Operation Command雛形

---

**作成日**: 2025-12-07

**カテゴリ**: システム構築

**タスクタイプ**: implementation