# Code Analyst Focus Strategy

最終更新日時: 2026年1月29日

## 📋 Skill Definition

```yaml
name: Code Analyst Focus
type: focus_strategy
version: 1.0

description: |
  コード解析スペシャリスト視点でのタスク分解戦略。
  既存コードベースを分析し、構造・依存関係・技術的負債を
  可視化する専門家の思考プロセスを実装。
  静的解析の知見を持ち、改善提案を行う。

applicable_goals:
  - コードベース解析
  - 技術的負債の可視化
  - リファクタリング計画
  - コード品質改善
  - アーキテクチャ理解
  keywords:
    - "コード解析"
    - "静的解析"
    - "技術的負債"
    - "リファクタリング"
    - "コード品質"
    - "依存関係"
```

---

## 🎯 分解原則（Decomposition Principles）

### 1. 構造解析ファースト

**全体俯瞰 → 詳細分析**

- まずコードベース全体の構造を俯瞰する
- ディレクトリ構成・モジュール分割を理解する
- エントリーポイントと主要な処理フローを特定する

### 2. 依存関係マップ

**関係性の可視化**

- モジュール間の依存関係を図示する
- 循環参照や過度な結合を検出する
- レイヤー構造の健全性を評価する

### 3. メトリクス駆動

**定量的評価**

- 複雑度（Cyclomatic Complexity）
- 重複率（Code Duplication）
- テストカバレッジ
- 保守性インデックス

---

## 📐 フェーズ構造（Phase Structure）

### Phase 1: Context Gathering（コンテキスト収集）

**目的**: コードベースの全体像把握

**典型的なタスク分解**:
- リポジトリ構造の解析
- 技術スタックの特定
- 主要な設定ファイルの確認
- ビルド・デプロイプロセスの理解
- 依存関係（package.json, requirements.txt等）の調査

### Phase 2: Static Analysis（静的解析）

**目的**: コード品質の定量評価

**典型的なタスク分解**:
- Linterの実行・結果分析
- コード複雑度の測定
- 重複コードの検出
- セキュリティ脆弱性スキャン
- デッドコードの特定

### Phase 3: Architecture Review（アーキテクチャレビュー）

**目的**: 設計構造の評価

**典型的なタスク分解**:
- 依存関係図の生成
- レイヤー構造の確認
- デザインパターンの認識
- 責務分離の評価
- 疎結合・高凝集度のチェック

### Phase 4: Technical Debt Assessment（技術的負債評価）

**目的**: 改善箇所の優先度付け

**典型的なタスク分解**:
- 技術的負債の洗い出し
- 影響度・修正コストの評価
- 改善優先度マトリクス作成
- リファクタリング計画の策定
- クイックウィンの提案

---

## 🔑 重要な考慮事項

### SubLayer判定基準

- **モジュール別解析**: フロントエンド/バックエンド/共通ライブラリ
- **レイヤー別解析**: Presentation/Business/Data層
- **機能ドメイン別**: 認証/決済/通知など
- **段階的深掘り**: 概要 → 詳細 → 超詳細

### Task判定基準

- **調査系**: 構造分析、技術スタック調査、依存関係調査
- **計測系**: メトリクス測定、カバレッジ計測
- **評価系**: 品質評価、技術的負債評価
- **提案系**: 改善提案、リファクタリング計画

---

## 💡 使用例

### 例1: レガシーコードの現状把握

**Goal**: 5年前のプロジェクトの技術的負債を可視化

**SubLayer分解例**:
- SG1: 全体構造・技術スタック調査
- SG2: 静的解析・メトリクス測定
- SG3: 技術的負債リスト作成
- SG4: リファクタリング計画策定

### 例2: マイクロサービス依存関係分析

**Goal**: 複数のマイクロサービスの依存関係を可視化

**SubLayer分解例**:
- SG1: サービス一覧・責務の整理
- SG2: API間通信の分析
- SG3: データフロー図の作成
- SG4: 疎結合化の提案

### 例3: コードベース構造分析（Task分解例）

**Goal**: 新規参画プロジェクトのコード理解

**Task分解例**:
- T001: READMEとドキュメントのレビュー
- T002: ディレクトリ構造の把握
- T003: 主要なエントリーポイント特定
- T004: 重要なクラス/関数の抽出
- T005: 依存関係図の作成
- T006: 技術的負債候補のリストアップ
- T007: オンボーディング資料の作成

---

## 🛠️ 推奨ツール・手法

### 静的解析ツール

**言語別**:
- JavaScript/TypeScript: ESLint, TSLint, SonarQube
- Python: Pylint, Flake8, Bandit, mypy
- Java: Checkstyle, PMD, SpotBugs
- Go: golint, staticcheck, go vet

### 可視化ツール

- **依存関係**: Madge, Dependency Cruiser, jdeps
- **アーキテクチャ**: PlantUML, Mermaid, Structurizr
- **メトリクス**: SonarQube, CodeClimate, Codacy

### 分析手法

- **コードリーディング**: トップダウン・ボトムアップ
- **動的解析**: デバッガーでの実行トレース
- **履歴分析**: Git履歴から変更頻度の高いファイル特定

---

## 📊 成果物テンプレート

### コード構造分析レポート

```markdown
# コード構造分析レポート

## 1. 概要
- プロジェクト名: 
- 主要言語: 
- フレームワーク: 
- 総行数: 

## 2. ディレクトリ構造
（ツリー図）

## 3. 技術スタック
- フロントエンド: 
- バックエンド: 
- データベース: 
- インフラ: 

## 4. 依存関係
（依存関係図）

## 5. 主要コンポーネント
| コンポーネント | 責務 | 複雑度 | 行数 |
|--------------|------|--------|------|

## 6. 所見
- 強み: 
- 課題: 
- 改善提案: 
```

### 技術的負債レポート

```markdown
# 技術的負債レポート

## 1. サマリ
| カテゴリ | 件数 | 重要度高 | 重要度中 | 重要度低 |
|----------|------|----------|----------|----------|

## 2. 負債リスト
### 2.1 設計レベル
- [ ] 循環参照の解消（SG1 → SG2 → SG1）
- [ ] God Objectの分割（XxxManager.java: 3000行）

### 2.2 コードレベル
- [ ] 重複コード削減（auth処理が5箇所に散在）
- [ ] 複雑な関数の分割（Complexity 15以上: 12関数）

### 2.3 テストレベル
- [ ] カバレッジ向上（現状42% → 目標80%）
- [ ] E2Eテストの追加

### 2.4 セキュリティレベル
- [ ] SQLインジェクション対策
- [ ] 認証トークンの適切な管理

## 3. 優先度マトリクス
（影響度×修正コストのマトリクス図）

## 4. 改善ロードマップ
- Phase 1（1ヶ月）: クイックウィン施策
- Phase 2（3ヶ月）: 重要度高の対応
- Phase 3（6ヶ月）: 構造改善
```

---

## 🎓 分析時の思考プロセス

### Step 1: 第一印象

```
「このコードベースの第一印象は？」
- ディレクトリ構造は整理されているか
- 命名規則は一貫しているか
- ドキュメントは充実しているか
```

### Step 2: 構造理解

```
「どういう構成になっているか？」
- MVCか？ Clean Architectureか？
- レイヤー分割は明確か？
- モジュール境界は適切か？
```

### Step 3: 依存関係

```
「モジュール間の関係は健全か？」
- 循環参照はないか？
- 結合度は低いか？
- 凝集度は高いか？
```

### Step 4: 品質評価

```
「コード品質はどうか？」
- 複雑度は許容範囲か？
- 重複は多くないか？
- テストは十分か？
```

### Step 5: 改善提案

```
「どこから手をつけるべきか？」
- 最も影響度が高い問題は？
- 修正コストが低いクイックウィンは？
- 段階的な改善計画は？
```

---

## ✅ 完了条件チェックリスト

- [ ] コード構造が図示されている
- [ ] 依存関係図が作成されている
- [ ] 技術的負債リストが作成されている
- [ ] メトリクスが測定・記録されている
- [ ] 改善提案が優先度付けされている
- [ ] 次のアクションが明確である

---

**作成日**: 2026-01-29
**ステータス**: Active
